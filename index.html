<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/x-icon" href="./src/assets/favicon2.ico">
    <title>Riksdata - Norske Data og Statistikk</title>
    <!-- Modular v1 - Dynamically generated charts! -->
    <link rel="stylesheet" href="./src/css/theme.css">
    <link rel="stylesheet" href="./src/css/main.css?v=2025-modular">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script type="module" src="./src/js/chart-theme.js" defer></script>
    <script src="./src/js/mood-rating.js" defer></script>

    <script>
        // Force cache refresh - Modular version
        console.log('ðŸš€ Modular version - Charts generated dynamically!');
        
        // Enhanced Chart.js loading with fallback
        let chartJsLoaded = false;
        
        function loadChartJsFallback() {
            if (typeof Chart !== 'undefined') {
                chartJsLoaded = true;
                console.log('Chart.js loaded successfully from primary CDN');
                return;
            }
            
            console.log('Primary CDN failed, trying fallback...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/chart.js@latest/dist/chart.umd.js';
            script.onload = function() {
                chartJsLoaded = true;
                console.log('Chart.js loaded successfully from fallback CDN');
            };
            script.onerror = function() {
                console.error('Both CDNs failed to load Chart.js');
                document.body.innerHTML = '<div style="padding: 20px; text-align: center; color: red; font-family: Arial, sans-serif; background: #f8f9fa; border: 1px solid #dc3545; border-radius: 8px; margin: 20px;">Feil: Chart.js-biblioteket kunne ikke lastes fra noen kilder. Vennligst sjekk internettforbindelsen din og last siden pÃ¥ nytt.</div>';
            };
            document.head.appendChild(script);
        }
        
        // Test if Chart.js loaded properly
        window.addEventListener('load', function() {
            setTimeout(loadChartJsFallback, 2000); // Give primary CDN 2 seconds
        });
    </script>
</head>
<body class="lang-no">
    <!-- Loading Progress Bar -->
    <div id="load-progress-bar" class="progress-bar load-progress-bar"></div>
    
    <!-- Scroll Progress Bar -->
    <div id="scroll-progress-bar" class="progress-bar scroll-progress-bar"></div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>Laster Riksdata</h2>
            <div id="loading-status" style="margin-top: 10px; font-size: 0.9em; opacity: 0.9;">
                Initialiserer<span class="loading-dots">...</span>
            </div>
        </div>
    </div>

    <!-- New Header Structure -->
    <header class="app-header">
        <div class="left-section">
            <button id="sidebar-toggle" class="icon-btn" aria-label="Ã…pne/lukk sidemeny" title="Ã…pne/lukk sidemeny">
                <span class="icon"></span>
            </button>
            <span class="app-title" onclick="window.location.reload()">Riksdata</span>
        </div>
        <div class="right-section">
            <!-- Search Input -->
            <div class="header-search">
                <input type="text" id="headerSearch" placeholder="SÃ¸k etter diagrammer..." class="header-search-input">
                <button id="searchApplyBtn" class="search-apply-btn" aria-label="Apply search" title="Apply search">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                </button>
            </div>
            
            <!-- Sort Toggle -->
            <button id="headerSortToggle" class="icon-btn" aria-label="Sort alphabetically" title="Sort alphabetically">
                <svg id="sortIcon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 8 4-4 4 4"/>
                    <path d="M7 4v16"/>
                    <path d="M20 8h-5"/>
                    <path d="M15 10V6.5a2.5 2.5 0 0 1 5 0V10"/>
                    <path d="M15 14h5l-5 6h5"/>
                </svg>
            </button>
            
        </div>
    </header>

    <!-- Political History Sidebar -->
    <aside id="sidebar" class="sidebar collapsed">
        <div class="sidebar-content">
            <div class="political-table">
                <!-- Header Row -->
                <div class="political-header">
                    <span class="header-party">Party</span>
                    <span class="header-pm">Minister</span>
                    <span class="header-coalition">Other</span>
                </div>

                <!-- Political Periods -->
                <div class="political-row">
                    <span class="party-color sp"></span>
                    <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                    <a href="https://no.wikipedia.org/wiki/Per_Bortens_regjering" class="regjering-name">Borten</a>
                    <span class="years">1965-1971</span>
                    <span class="coalition-parties">
                        <a href="https://hoyre.no/" class="party-short">H</a>
                        <a href="https://www.krf.no/" class="party-short">KrF</a>
                        <a href="https://www.venstre.no/" class="party-short">V</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Trygve_Brattelis_f%C3%B8rste_regjering" class="regjering-name">Bratteli I</a>
                    <span class="years">1971-1972</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color krf"></span>
                    <a href="https://www.krf.no/" class="party-short">KrF</a>
                    <a href="https://no.wikipedia.org/wiki/Lars_Korvalds_regjering" class="regjering-name">Korvald</a>
                    <span class="years">1972-1973</span>
                    <span class="coalition-parties">
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                        <a href="https://www.venstre.no/" class="party-short">V</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Trygve_Brattelis_andre_regjering" class="regjering-name">Bratteli II</a>
                    <span class="years">1973-1976</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Odvar_Nordlis_regjering" class="regjering-name">Nordli</a>
                    <span class="years">1976-1981</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Gro_Harlem_Brundtlands_f%C3%B8rste_regjering" class="regjering-name">Brundtland I</a>
                    <span class="years">1981</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color h"></span>
                    <a href="https://hoyre.no/" class="party-short">H</a>
                    <a href="https://no.wikipedia.org/wiki/K%C3%A5re_Willochs_regjering" class="regjering-name">Willoch</a>
                    <span class="years">1981-1986</span>
                    <span class="coalition-parties">
                        <a href="https://www.krf.no/" class="party-short">KrF</a>
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Gro_Harlem_Brundtlands_andre_regjering" class="regjering-name">Brundtland II</a>
                    <span class="years">1986-1989</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color h"></span>
                    <a href="https://hoyre.no/" class="party-short">H</a>
                    <a href="https://no.wikipedia.org/wiki/Jan_P._Syses_regjering" class="regjering-name">Syse</a>
                    <span class="years">1989-1990</span>
                    <span class="coalition-parties">
                        <a href="https://www.krf.no/" class="party-short">KrF</a>
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Gro_Harlem_Brundtlands_tredje_regjering" class="regjering-name">Brundtland III</a>
                    <span class="years">1990-1996</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Thorbj%C3%B8rn_Jaglands_regjering" class="regjering-name">Jagland</a>
                    <span class="years">1996-1997</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color krf"></span>
                    <a href="https://www.krf.no/" class="party-short">KrF</a>
                    <a href="https://no.wikipedia.org/wiki/Kjell_Magne_Bondeviks_f%C3%B8rste_regjering" class="regjering-name">Bondevik I</a>
                    <span class="years">1997-2000</span>
                    <span class="coalition-parties">
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                        <a href="https://www.venstre.no/" class="party-short">V</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Jens_Stoltenbergs_f%C3%B8rste_regjering" class="regjering-name">Stoltenberg I</a>
                    <span class="years">2000-2001</span>
                    <span class="coalition-parties"></span>
                </div>

                <div class="political-row">
                    <span class="party-color krf"></span>
                    <a href="https://www.krf.no/" class="party-short">KrF</a>
                    <a href="https://no.wikipedia.org/wiki/Kjell_Magne_Bondeviks_andre_regjering" class="regjering-name">Bondevik II</a>
                    <span class="years">2001-2005</span>
                    <span class="coalition-parties">
                        <a href="https://hoyre.no/" class="party-short">H</a>
                        <a href="https://www.venstre.no/" class="party-short">V</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.wikipedia.org/wiki/Jens_Stoltenbergs_andre_regjering" class="regjering-name">Stoltenberg II</a>
                    <span class="years">2005-2013</span>
                    <span class="coalition-parties">
                        <a href="https://www.sv.no/" class="party-short">SV</a>
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color h"></span>
                    <a href="https://hoyre.no/" class="party-short">H</a>
                    <a href="https://no.wikipedia.org/wiki/Erna_Solbergs_regjering" class="regjering-name">Solberg</a>
                    <span class="years">2013-2021</span>
                    <span class="coalition-parties">
                        <a href="https://www.frp.no/" class="party-short">FrP</a>
                        <a href="https://www.venstre.no/" class="party-short">V</a>
                        <a href="https://www.krf.no/" class="party-short">KrF</a>
                    </span>
                </div>

                <div class="political-row">
                    <span class="party-color ap"></span>
                    <a href="https://www.arbeiderpartiet.no/" class="party-short">Ap</a>
                    <a href="https://no.arbeiderpartiet.no/" class="regjering-name">StÃ¸re</a>
                    <span class="years">2021-Present</span>
                    <span class="coalition-parties">
                        <a href="https://www.senterpartiet.no/" class="party-short">Sp</a>
                    </span>
                </div>
            </div>
        </div>
    </aside>

    <!-- Mobile backdrop for sidebar overlay -->
    <div id="sidebar-backdrop" class="sidebar-backdrop" style="display: none;"></div>

    <!-- Main Content -->
    <main class="main-content" id="main-dashboard">
        <!-- Chart cards will be dynamically inserted here -->
        <div class="chart-grid"></div>
    </main>

    <footer>
        <div class="footer-content">
            <!-- Data Sources Column -->
            <div class="footer-section">
                <h4>Datakilder</h4>
                <div class="data-sources">
                    <a href="https://www.ssb.no/" target="_blank" class="source-link" aria-label="Visit Statistics Norway (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Statistics Norway (SSB)
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.norges-bank.no/" target="_blank" class="source-link" aria-label="Visit Norges Bank (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Norges Bank
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.nve.no/" target="_blank" class="source-link" aria-label="Visit NVE (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        NVE
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://driftsdata.statnett.no/restapi" target="_blank" class="source-link" aria-label="Visit Statnett (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Statnett
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://data.stortinget.no/" target="_blank" class="source-link" aria-label="Visit Stortinget (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Stortinget
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://finance.yahoo.com/" target="_blank" class="source-link" aria-label="Visit Yahoo Finance (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Yahoo Finance
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://ourworldindata.org/" target="_blank" class="source-link" aria-label="Visit Our World in Data (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        Our World in Data
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="https://www.dfo.no/" target="_blank" class="source-link" aria-label="Visit DFO (opens in new tab)">
                        <i data-lucide="check-circle" class="source-icon" aria-hidden="true"></i>
                        DFO (Norwegian Budget)
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                </div>
            </div>
            
            <!-- Contact Column -->
            <div class="footer-section">
                <h4>Kontakt</h4>
                <div class="contact-links">
                    <a href="https://github.com/egil10/riksdata" target="_blank" class="contact-link" aria-label="Visit GitHub repository (opens in new tab)">
                        <i data-lucide="github" class="contact-icon" aria-hidden="true"></i>
                        GitHub
                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                    </a>
                    <a href="mailto:contact@riksdata.no" class="contact-link" aria-label="Send email to contact@riksdata.no">
                        <i data-lucide="mail" class="contact-icon" aria-hidden="true"></i>
                        Email
                    </a>
                </div>
                
                <!-- Mood Rating Section -->
                <div class="mood-section">
                    <div class="mood-container">
                        <button class="mood-btn" data-mood="happy" aria-label="Rate as happy">
                            <i data-lucide="smile" aria-hidden="true"></i>
                        </button>
                        <button class="mood-btn" data-mood="neutral" aria-label="Rate as neutral">
                            <i data-lucide="meh" aria-hidden="true"></i>
                        </button>
                        <button class="mood-btn" data-mood="sad" aria-label="Rate as sad">
                            <i data-lucide="frown" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- About Column -->
            <div class="footer-section">
                <h4>Om Riksdata</h4>
                <div class="about-content">
                    <p>Omfattende dashboard for norske Ã¸konomiske indikatorer med politisk kontekst. Visualisering av Norges Ã¸konomiske data siden 1945.</p>
                    <p class="disclaimer-text">Riksdata presenterer diagrammer fra offentlige API-er (f.eks. Statistisk sentralbyrÃ¥, Norges Bank og andre offisielle kilder). Intet ansvar tas for nÃ¸yaktighet eller fullstendighet â€” verifiser alltid via kildelenkene.</p>
                    <p class="footer-copyright">&copy; <span id="copyright-year">2025</span> Riksdata. Alle rettigheter reservert. <a href="#top" class="back-to-top" aria-label="Tilbake til toppen">â†‘ Tilbake til toppen</a></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top-btn" title="Tilbake til toppen">
        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </button>

    <!-- Debug Panel (hidden by default) -->
    <div id="debug" style="display: none; position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-width: 300px; z-index: 10000;">
        <h4>Fetch Status</h4>
        <ul id="fetchStatus"></ul>
    </div>

    <!-- Diagnostic Script -->
    <script>
        // Quick diagnostic to help identify loading issues
        (function() {
            console.log('=== RIKSDATA DIAGNOSTIC ===');
            console.log('Document ready state:', document.readyState);
            console.log('Chart.js available:', typeof Chart !== 'undefined');
            console.log('Current URL:', window.location.href);
            
            // Monitor for errors
            window.addEventListener('error', (e) => {
                console.error('Runtime error:', e.error || e.message);
            });
            
            window.addEventListener('unhandledrejection', (e) => {
                console.error('Unhandled promise rejection:', e.reason);
            });
            
            console.log('=== END DIAGNOSTIC ===');
        })();
    </script>

    <script type="module" src="./src/js/main.js?v=2025-modular" defer></script>
    <script type="module" src="./src/js/drilldown.js?v=2025-drilldown" defer></script>
    
    <!-- Lucide Icons CDN and Helpers -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      // Safe helper: set a Lucide icon into a button (uses data-lucide + createIcons)
      function setLucideIcon(btn, iconName, size = 20) {
        if (!window.lucide) { console.warn('Lucide not loaded'); return; }
        const oldSvg = btn.querySelector('svg');
        if (oldSvg) oldSvg.remove();
        let placeholder = btn.querySelector('i[data-lucide]');
        if (!placeholder) {
          placeholder = document.createElement('i');
          btn.appendChild(placeholder);
        }
        placeholder.setAttribute('data-lucide', iconName);
        lucide.createIcons({ attrs: { width: size, height: size } });
      }

      // Wire up everything after DOM is ready
      document.addEventListener('DOMContentLoaded', () => {
        // Initial render pass (replace all data-lucide in DOM)
        if (window.lucide) lucide.createIcons({ attrs: { width: 20, height: 20 } });
        
        // Sidebar toggle
        (function initSidebarToggle(){
          const btn = document.getElementById('sidebar-toggle');
          if (!btn) return;
          if (!document.body.classList.contains('is-sidebar-open')) {
            document.body.classList.add('is-sidebar-open');
          }
          function sync() {
            const open = document.body.classList.contains('is-sidebar-open');
            setLucideIcon(btn, open ? 'panel-left-open' : 'panel-left-close');
            btn.setAttribute('aria-pressed', String(open));
            btn.title = open ? 'Close sidebar' : 'Open sidebar';
            btn.setAttribute('aria-label', btn.title);
          }
          btn.addEventListener('click', () => {
            document.body.classList.toggle('is-sidebar-open');
            sync();
          });
          if (!btn.querySelector('i[data-lucide], svg')) {
            const i = document.createElement('i'); i.setAttribute('data-lucide','panel-left-open');
            btn.appendChild(i);
          }
          sync();
        })();
        
        // Update copyright year dynamically
        const copyrightYear = document.getElementById('copyright-year');
        if (copyrightYear) {
          copyrightYear.textContent = new Date().getFullYear();
        }
      });
    </script>

</body>
</html>
